<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>💔 Breakup Recovery Assistant</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    body {
      background: linear-gradient(135deg, #FFDEE9 0%, #B5FFFC 100%);
      font-family: 'Inter', sans-serif;
    }
    .card-shadow {
      box-shadow: 0 10px 15px -3px rgb(219 39 119 / 0.1), 0 4px 6px -2px rgb(219 39 119 / 0.05);
    }
    .btn-gradient:hover {
      background-image: linear-gradient(45deg, #ec4899, #8b5cf6);
      transition: background-image 0.3s ease-in-out;
    }
    .tab-active {
      border-bottom: 4px solid #ec4899;
      font-weight: bold;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col text-gray-900">
  <div class="container mx-auto px-6 py-12 flex-grow max-w-5xl">
    <h1 class="text-5xl font-extrabold text-center text-pink-600 mb-12 drop-shadow-lg">
      💔 Breakup Recovery Assistant
    </h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="mb-8 max-w-3xl mx-auto">
        {% for category, message in messages %}
          <div class="text-red-700 font-semibold mb-3 rounded-md bg-red-100 p-3 shadow-md">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}
    {% endwith %}

    <form method="POST" class="bg-white rounded-2xl p-8 max-w-3xl mx-auto card-shadow space-y-8 relative">
      <textarea
        name="user_input"
        rows="6"
        placeholder="📝 Tell us your breakup story or feelings..."
        class="w-full border border-pink-300 rounded-lg px-5 py-4 resize-y text-lg placeholder-pink-400 focus:outline-none focus:ring-4 focus:ring-pink-300 shadow-sm"
        required
      ></textarea>

      <button
        type="submit"
        class="w-full bg-gradient-to-r from-pink-400 via-purple-500 to-indigo-600 text-white font-extrabold text-xl py-4 rounded-xl shadow-lg btn-gradient hover:scale-105 transform transition"
      >
        Generate Support Plan 💝
      </button>

      <div id="loadingSpinner" class="hidden absolute inset-0 bg-white/70 flex items-center justify-center rounded-2xl">
        <div class="loader border-t-4 border-pink-600 border-solid rounded-full w-12 h-12 animate-spin"></div>
      </div>
    </form>

    {% if therapist %}
    <!-- Tabs -->
    <div class="mt-14 max-w-5xl mx-auto">
      <div class="flex space-x-4 border-b mb-6">
        <button class="tab-btn tab-active px-4 py-2" data-tab="therapist">🤗 Therapist</button>
        <button class="tab-btn px-4 py-2" data-tab="closure">✍ Closure</button>
        <button class="tab-btn px-4 py-2" data-tab="planner">📅 Recovery Plan</button>
        <button class="tab-btn px-4 py-2" data-tab="honesty">💪 Brutal Honesty</button>
      </div>

      <div class="tab-content space-y-6">
        <section id="therapist" class="bg-white p-7 rounded-2xl shadow-xl prose max-w-none border-l-8 border-pink-400">
          <h2 class="text-3xl font-bold text-pink-600 mb-5 flex justify-between items-center">
            🤗 Therapist Response
            <button onclick="copyToClipboard('therapist')" class="text-sm bg-pink-600 text-white px-3 py-1 rounded hover:bg-pink-700">Copy</button>
          </h2>
          <div>{{ therapist }}</div>
        </section>

        <section id="closure" class="hidden bg-white p-7 rounded-2xl shadow-xl prose max-w-none border-l-8 border-purple-500">
          <h2 class="text-3xl font-bold text-purple-600 mb-5 flex justify-between items-center">
            ✍ Closure Message
            <button onclick="copyToClipboard('closure')" class="text-sm bg-purple-600 text-white px-3 py-1 rounded hover:bg-purple-700">Copy</button>
          </h2>
          <div>{{ closure }}</div>
        </section>

        <section id="planner" class="hidden bg-white p-7 rounded-2xl shadow-xl prose max-w-none border-l-8 border-indigo-600">
          <h2 class="text-3xl font-bold text-indigo-600 mb-5 flex justify-between items-center">
            📅 7-Day Recovery Plan
            <button onclick="copyToClipboard('planner')" class="text-sm bg-indigo-600 text-white px-3 py-1 rounded hover:bg-indigo-700">Copy</button>
          </h2>
          <div>{{ planner }}</div>
        </section>

        <section id="honesty" class="hidden bg-white p-7 rounded-2xl shadow-xl prose max-w-none border-l-8 border-pink-700">
          <h2 class="text-3xl font-bold text-pink-700 mb-5 flex justify-between items-center">
            💪 Brutal Honesty
            <button onclick="copyToClipboard('honesty')" class="text-sm bg-pink-700 text-white px-3 py-1 rounded hover:bg-pink-800">Copy</button>
          </h2>
          <div>{{ honesty }}</div>
        </section>
      </div>
    </div>
    {% endif %}

    <footer class="mt-20 text-center text-pink-700 text-sm font-medium select-none">
<p class="text-red-500 text-2xl font-semibold text-center fade-up glow-loop">
  🌱 “Small steps every day lead to big changes over time.”
</p>

<style>
  @keyframes fadeUp {
    0% {
      opacity: 0;
      transform: translateY(20px);
      text-shadow: none;
    }
    50% {
      opacity: 1;
      transform: translateY(0);
      text-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
    }
    100% {
      text-shadow: 0 0 15px rgba(255, 0, 0, 0.7), 0 0 30px rgba(255, 0, 0, 0.3);
    }
  }

  @keyframes glow {
    from {
      text-shadow: 0 0 5px rgba(255, 0, 0, 0.3);
    }
    to {
      text-shadow: 0 0 20px rgba(255, 0, 0, 0.8), 0 0 40px rgba(255, 0, 0, 0.5);
    }
  }

  .fade-up {
    animation: fadeUp 2s ease-out forwards;
  }

  .glow-loop {
    animation: glow 3s ease-in-out infinite alternate;
  }
</style>
    </footer>
  </div>

  <script>
    // Markdown rendering
    document.addEventListener("DOMContentLoaded", () => {
      ["therapist","closure","planner","honesty"].forEach(id => {
        const el = document.getElementById(id);
        if(el) el.innerHTML = marked.parse(el.innerText || el.textContent);
      });

      // Tab switching
      const tabs = document.querySelectorAll(".tab-btn");
      const sections = document.querySelectorAll(".tab-content section");

      tabs.forEach(tab => {
        tab.addEventListener("click", () => {
          tabs.forEach(t => t.classList.remove("tab-active"));
          tab.classList.add("tab-active");

          sections.forEach(sec => sec.classList.add("hidden"));
          const target = document.getElementById(tab.dataset.tab);
          if(target) target.classList.remove("hidden");
        });
      });
    });

    // Copy to clipboard
    function copyToClipboard(id) {
      const text = document.getElementById(id).innerText;
      navigator.clipboard.writeText(text).then(() => {
        alert("Copied to clipboard!");
      });
    }

    // Show loading spinner
    const form = document.querySelector("form");
    const spinner = document.getElementById("loadingSpinner");
    form?.addEventListener("submit", () => {
      spinner.classList.remove("hidden");
    });
  </script>
</body>
</html>
